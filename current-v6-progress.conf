# =============================================================================
# KEA DHCPv6 CONFIGURATION (L2 DIRECT ONLY - VARIABLE TEMPLATE)
#
# Parsed as JSON with Kea-style comments.
# Validate with:
#   kea-dhcp6 -t -c /etc/kea/kea-dhcp6.conf
# =============================================================================

{
  "Dhcp6": {

    # -------------------------------------------------------------------------
    # INTERFACE CONFIG
    # -------------------------------------------------------------------------
    "interfaces-config": {
      "interfaces": [ "${DHCP6_INTERFACE}" ]
    },

    # -------------------------------------------------------------------------
    # CONTROL SOCKET
    # -------------------------------------------------------------------------
    "control-socket": {
      "socket-type": "unix",
      "socket-name": "${KEA6_CONTROL_SOCKET}"
    },

    # -------------------------------------------------------------------------
    # LEASE DATABASE (MySQL)
    # -------------------------------------------------------------------------
    "lease-database": {
      "type": "mysql",
      "name": "${DB_NAME}",
      "user": "${DB_USER}",
      "password": "${DB_USER_PASSWORD}",
      "host": "${DB_HOST}",
      "port": ${DB_PORT}
    },

    # -------------------------------------------------------------------------
    # HOSTS DATABASE (MySQL)
    # -------------------------------------------------------------------------
    "hosts-database": {
      "type": "mysql",
      "name": "${DB_NAME}",
      "user": "${DB_USER}",
      "password": "${DB_USER_PASSWORD}",
      "host": "${DB_HOST}",
      "port": ${DB_PORT}
    },

    # -------------------------------------------------------------------------
    # LEASE TIMERS
    # -------------------------------------------------------------------------
    "expired-leases-processing": {
      "reclaim-timer-wait-time": ${RECLAIM_WAIT_TIME},
      "flush-reclaimed-timer-wait-time": ${FLUSH_WAIT_TIME},
      "hold-reclaimed-time": ${HOLD_RECLAIM_TIME},
      "max-reclaim-leases": ${MAX_RECLAIM_LEASES},
      "max-reclaim-time": ${MAX_RECLAIM_TIME},
      "unwarned-reclaim-cycles": ${UNWARNED_RECLAIM_CYCLES}
    },

    # -------------------------------------------------------------------------
    # T1/T2 CALCULATION
    # -------------------------------------------------------------------------
    "calculate-tee-times": ${CALCULATE_TEE_TIMES},

    # -------------------------------------------------------------------------
    # LIFETIMES
    # -------------------------------------------------------------------------
    "preferred-lifetime": ${PREFERRED_LIFETIME},
    "valid-lifetime": ${VALID_LIFETIME},

    # -------------------------------------------------------------------------
    # GLOBAL OPTIONS
    # -------------------------------------------------------------------------
    "option-data": [
      {
        "name": "dns-servers",
        "data": "${IPV6_DNS_SERVERS}"
      }
    ],

    # -------------------------------------------------------------------------
    # HOOK LIBRARIES
    # -------------------------------------------------------------------------
    "hooks-libraries": [
      {
        "library": "${KEA_HOOK_MYSQL_LIB}"
      },
      {
        "library": "${KEA_HOOK_HOST_CMDS_LIB}"
      }
    ],

    # -------------------------------------------------------------------------
    # SUBNET DEFINITION (L2 DIRECT ONLY)
    # -------------------------------------------------------------------------
    "subnet6": [
      {
        "id": ${SUBNET6_ID},
        "subnet": "${IPV6_SUBNET_CIDR}",
        "interface": "${DHCP6_INTERFACE}",
        "pools": [
          {
            "pool": "${IPV6_POOL_RANGE}"
          }
        ]
      }
    ],

    # -------------------------------------------------------------------------
    # LOGGING
    # -------------------------------------------------------------------------
    "loggers": [
      {
        "name": "kea-dhcp6",
        "output_options": [
          {
            "output": "${KEA6_LOG_FILE}",
            "pattern": "%d %-5p [%c] %m\n",
            "maxsize": ${LOG_MAX_SIZE},
            "maxver": ${LOG_MAX_VERSIONS}
          }
        ],
        "severity": "${LOG_SEVERITY}",
        "debuglevel": ${LOG_DEBUG_LEVEL}
      }
    ]
  }
}
